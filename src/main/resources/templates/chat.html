<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Spring Boot WebSocket Chat</title>
    <script src="https://cdn.jsdelivr.net/npm/sockjs-client@1/dist/sockjs.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/stompjs@2.3.3/lib/stomp.min.js"></script>
  </head>
  <body>
    <h2>WebSocket Chat Demo ðŸ’¬</h2>

    <input type="text" id="sender" placeholder="Enter your name" /><br /><br />
    <input type="text" id="message" placeholder="Enter message" />
    <button onclick="sendMessage()">Send</button>

    <ul id="chat"></ul>

    <script>
      let stompClient = null;

      function connect() {
        const socket = new SockJS("/ws");
        stompClient = Stomp.over(socket);
        stompClient.connect({}, () => {
          console.log("Connected âœ…");
          stompClient.subscribe("/topic/public", (msg) => {
            const message = JSON.parse(msg.body);
            const chat = document.getElementById("chat");
            const li = document.createElement("li");
            li.textContent = message.sender + ": " + message.content;
            chat.appendChild(li);
          });
        });
      }

      function sendMessage() {
        const sender = document.getElementById("sender").value;
        const message = document.getElementById("message").value;
        stompClient.send(
          "/app/sendMessage",
          {},
          JSON.stringify({ sender, content: message })
        );
        document.getElementById("message").value = "";
      }

      connect();
    </script>
  </body>
</html>
